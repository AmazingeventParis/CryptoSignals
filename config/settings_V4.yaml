# ============================================
# CRYPTO SIGNALS - Configuration V4 (V1 STRICT + V4 INTELLIGENCE)
# Filtres V1 (100% WR) + features V4 (regime, MTF, VWAP, learning, fee-aware)
# ============================================

# --- Paires surveillees ---
pairs:
  - symbol: "XRP/USDT:USDT"
    enabled: true
  - symbol: "DOGE/USDT:USDT"
    enabled: true
  - symbol: "PEPE/USDT:USDT"
    enabled: true
  - symbol: "RUNE/USDT:USDT"
    enabled: true
  - symbol: "SOL/USDT:USDT"
    enabled: true
  - symbol: "KAITO/USDT:USDT"
    enabled: true
  - symbol: "BTC/USDT:USDT"
    enabled: true
  - symbol: "VIRTUAL/USDT:USDT"
    enabled: true
  - symbol: "TRUMP/USDT:USDT"
    enabled: true
  - symbol: "AVAX/USDT:USDT"
    enabled: true
  - symbol: "LINK/USDT:USDT"
    enabled: true
  - symbol: "NEAR/USDT:USDT"
    enabled: true
  - symbol: "SUI/USDT:USDT"
    enabled: true
  - symbol: "ARB/USDT:USDT"
    enabled: true
  - symbol: "WIF/USDT:USDT"
    enabled: true

# --- Scanner ---
scanner:
  interval_seconds: 60
  modes:
    - scalping
    - swing

# --- Mode Scalping (1-5 min) ---
scalping:
  timeframes:
    analysis:
      - "1m"
      - "5m"
    filter: "15m"

  entry:
    min_score: 65              # V1 strict (was 55)
    setups:
      - breakout
      - retest
      - ema_bounce
      - momentum
      - divergence
    confirmation_candles: 1

  max_loss_usd: 0.25    # cap absolu par trade scalping (avant SL)

  stop_loss:
    method: "atr"
    atr_multiplier: 1.5
    max_stop_pct: 0.5

  take_profit:
    tp1_rr: 1.0
    tp1_close_pct: 40          # V1: garde plus de qty pour TP2/3 (was 50)
    tp2_rr: 1.5
    tp2_close_pct: 30
    tp3_rr: 2.5                # V1: vise plus haut (was 2.0)
    tp3_close_pct: 30          # V1: 30% sur le gros TP (was 20)

  early_protection:
    breakeven_at_pct: 50
    trail_activation_pct: 65
    trail_behind_pct: 35

  max_hold_seconds: 3600     # V4: 1h max pour scalping stagnant

  break_even:
    trigger: "tp1"

  trailing_stop:
    activate_after: "tp2"
    trail_distance_atr: 0.8

  cooldown:
    after_loss_seconds: 300
    after_win_seconds: 120
    max_consecutive_losses: 3
    pause_after_max_losses_seconds: 900

  risk:
    max_risk_per_trade_pct: 1.0
    leverage_range: [10, 12]
    margin_mode: "isolated"

# --- Mode Swing Court (15-30 min) ---
swing:
  timeframes:
    analysis:
      - "5m"
      - "15m"
    filter: "1h"

  entry:
    min_score: 70              # V1 strict (was 60)
    setups:
      - breakout
      - retest
      - divergence
      - ema_bounce
      - momentum
    confirmation_candles: 2    # V1: double confirmation (was 1)

  max_loss_usd: 0.40    # cap absolu par trade swing (avant SL)

  stop_loss:
    method: "structure"
    buffer_atr: 0.5
    max_stop_pct: 1.0

  take_profit:
    tp1_rr: 1.5
    tp1_close_pct: 33          # V1: distribution equilibree (was 45)
    tp2_rr: 2.5                # V1: vise plus haut (was 2.0)
    tp2_close_pct: 33          # V1 (was 30)
    tp3_rr: 4.0                # V1: gros TP (was 3.0)
    tp3_close_pct: 34          # V1 (was 25)

  early_protection:
    breakeven_at_pct: 50
    trail_activation_pct: 65
    trail_behind_pct: 35

  max_hold_seconds: 14400    # V4: 4h max pour swing stagnant

  break_even:
    trigger: "tp1"

  trailing_stop:
    activate_after: "tp2"
    trail_distance_atr: 1.2

  cooldown:
    after_loss_seconds: 300
    after_win_seconds: 120
    max_consecutive_losses: 3
    pause_after_max_losses_seconds: 1800

  risk:
    max_risk_per_trade_pct: 1.0
    leverage_range: [10, 15]
    margin_mode: "isolated"

# --- Couche A: Tradeability Filter ---
tradeability:
  min_score: 0.60              # V1 strict (was 0.35) - marches propres uniquement
  weights:
    volatility: 0.17
    volume: 0.17
    spread: 0.17
    depth: 0.12
    funding: 0.12
    oi_stability: 0.10
    adx_trend: 0.10
    order_flow: 0.05           # V4: poids order flow
  thresholds:
    atr_min_ratio: 0.5
    atr_max_ratio: 3.0
    volume_min_ratio: 0.4      # V1 strict (was 0.2) - exige 2x plus de volume
    spread_max_scalp: 0.05     # V1 strict (was 0.10) - spreads ultra-serres
    spread_max_swing: 0.08     # V1 strict (was 0.15)
    spread_kill: 0.15          # V1 strict (was 0.30) - kill 2x plus tot
    funding_max: 0.1
    funding_kill: 0.3
    oi_drop_max_pct: 5.0

# --- Couche B: Direction Filter ---
direction:
  ema_fast: 20
  ema_slow: 50
  ema_neutral_threshold: 0.10   # V1 strict (was 0.05) - ecarte faux croisements
  rsi_period: 14
  rsi_long_threshold: 55        # V1 strict (was 52) - plus de conviction
  rsi_short_threshold: 45       # V1 strict (was 48)
  structure_lookback: 20

# --- Couche C: Entry Triggers ---
entry:
  bb_period: 20
  bb_std: 2
  bb_squeeze_threshold: 0.02   # V1 strict (was 0.03) - compression plus nette
  volume_spike_ratio: 1.5      # V1 strict (was 1.2) - breakouts plus nets
  retest_buffer_pct: 0.1
  rejection_wick_ratio: 0.5
  divergence_lookback: 14
  ema_bounce_proximity_pct: 0.15  # V1 strict (was 0.30) - bounce plus pres de l'EMA

# --- Scoring ---
scoring:
  weights:
    tradeability: 0.30
    direction: 0.25
    setup: 0.25
    sentiment: 0.20
  setup_components:
    pattern_quality: 30
    volume_confirmation: 20
    risk_reward: 25
    confluence: 25
  thresholds:
    strong: 80
    medium: 65
    weak: 50

# --- V4 specifique ---
# Direction neutre en swing = BLOQUE (comme V1 - pas de trade en indecision)
swing_neutral_allowed: false

# --- Anti-correlation ---
anti_correlation:
  max_same_direction: 5       # max positions dans la meme direction

# --- Profit Giveback Protection ---
profit_protection:
  activation_fee_mult: 3.0    # active quand peak > fees * 3 (~$0.18)
  giveback_pct: 50            # ferme si >50% du peak rendu

# --- V4 Features ---
v4_features:
  regime_detection: true       # Detection regime TRENDING/RANGING/VOLATILE
  mtf_confluence: true         # Multi-timeframe confluence scoring
  vwap_confluence: true        # VWAP comme S/R dynamique
  order_flow: true             # Analyse ratio bid/ask
  adaptive_learning: true      # Moteur d'apprentissage adaptatif
  stale_exit: true             # Fermeture positions stagnantes
  dynamic_sl: true             # Ajustement SL selon volatilite
  anti_correlation: true       # Garde max 3 positions meme direction

# --- Frais de trading ---
fees:
  taker_pct: 0.06  # MEXC taker fee 0.06%

# --- Position Sizing dynamique ---
sizing:
  base_pct: 8          # % du solde par trade
  min_margin: 3         # marge minimum $
  max_margin: 15        # marge maximum $ (reduit pour limiter pertes)

# --- Trailing TP apres TP3 ---
trailing_tp:
  enabled: true
  tp3_close_pct: 50     # fermer 50% a TP3
  trail_atr: 1.0        # trail le reste a 1.0x ATR

# --- Risk Limits ---
risk_limits:
  max_daily_loss_usd: 15.0
  max_consecutive_losses: 10
  pause_minutes: 15

# --- Dashboard ---
dashboard:
  host: "0.0.0.0"
  port: 8000
