# ============================================
# CRYPTO SIGNALS - Configuration V4 (ADAPTIVE LEARNING)
# Base V2 + analyse avancee + apprentissage adaptatif + gestion positions intelligente
# ============================================

# --- Paires surveillees ---
pairs:
  - symbol: "XRP/USDT:USDT"
    enabled: true
  - symbol: "DOGE/USDT:USDT"
    enabled: true
  - symbol: "PEPE/USDT:USDT"
    enabled: true
  - symbol: "RUNE/USDT:USDT"
    enabled: true
  - symbol: "SOL/USDT:USDT"
    enabled: true
  - symbol: "KAITO/USDT:USDT"
    enabled: true
  - symbol: "BTC/USDT:USDT"
    enabled: true
  - symbol: "VIRTUAL/USDT:USDT"
    enabled: true
  - symbol: "TRUMP/USDT:USDT"
    enabled: true

# --- Scanner ---
scanner:
  interval_seconds: 60
  modes:
    - scalping
    - swing

# --- Mode Scalping (1-5 min) ---
scalping:
  timeframes:
    analysis:
      - "1m"
      - "5m"
    filter: "15m"

  entry:
    min_score: 55
    setups:
      - breakout
      - retest
      - ema_bounce
      - momentum
      - divergence
    confirmation_candles: 1

  stop_loss:
    method: "atr"
    atr_multiplier: 1.8
    max_stop_pct: 0.7

  take_profit:
    tp1_rr: 1.0
    tp1_close_pct: 50
    tp2_rr: 1.5
    tp2_close_pct: 30
    tp3_rr: 2.0
    tp3_close_pct: 20

  early_protection:
    breakeven_at_pct: 50
    trail_activation_pct: 65
    trail_behind_pct: 35

  max_hold_seconds: 1800     # V4: 30 min max pour scalping stagnant

  break_even:
    trigger: "tp1"

  trailing_stop:
    activate_after: "tp2"
    trail_distance_atr: 0.8

  cooldown:
    after_loss_seconds: 300
    after_win_seconds: 120
    max_consecutive_losses: 3
    pause_after_max_losses_seconds: 900

  risk:
    max_risk_per_trade_pct: 1.0
    leverage_range: [10, 12]
    margin_mode: "isolated"

# --- Mode Swing Court (15-30 min) ---
swing:
  timeframes:
    analysis:
      - "5m"
      - "15m"
    filter: "1h"

  entry:
    min_score: 60
    setups:
      - breakout
      - retest
      - divergence
      - ema_bounce
      - momentum
    confirmation_candles: 1

  stop_loss:
    method: "structure"
    buffer_atr: 0.5
    max_stop_pct: 1.0

  take_profit:
    tp1_rr: 1.5
    tp1_close_pct: 45
    tp2_rr: 2.0
    tp2_close_pct: 30
    tp3_rr: 3.0
    tp3_close_pct: 25

  early_protection:
    breakeven_at_pct: 50
    trail_activation_pct: 65
    trail_behind_pct: 35

  max_hold_seconds: 7200     # V4: 2h max pour swing stagnant

  break_even:
    trigger: "tp1"

  trailing_stop:
    activate_after: "tp2"
    trail_distance_atr: 1.2

  cooldown:
    after_loss_seconds: 300
    after_win_seconds: 120
    max_consecutive_losses: 3
    pause_after_max_losses_seconds: 1800

  risk:
    max_risk_per_trade_pct: 1.0
    leverage_range: [10, 15]
    margin_mode: "isolated"

# --- Couche A: Tradeability Filter ---
tradeability:
  min_score: 0.35
  weights:
    volatility: 0.17
    volume: 0.17
    spread: 0.17
    depth: 0.12
    funding: 0.12
    oi_stability: 0.10
    adx_trend: 0.10
    order_flow: 0.05           # V4: poids order flow
  thresholds:
    atr_min_ratio: 0.5
    atr_max_ratio: 3.0
    volume_min_ratio: 0.2
    spread_max_scalp: 0.10
    spread_max_swing: 0.15
    spread_kill: 0.30
    funding_max: 0.1
    funding_kill: 0.3
    oi_drop_max_pct: 5.0

# --- Couche B: Direction Filter ---
direction:
  ema_fast: 20
  ema_slow: 50
  ema_neutral_threshold: 0.05
  rsi_period: 14
  rsi_long_threshold: 52
  rsi_short_threshold: 48
  structure_lookback: 20

# --- Couche C: Entry Triggers ---
entry:
  bb_period: 20
  bb_std: 2
  bb_squeeze_threshold: 0.03
  volume_spike_ratio: 1.2
  retest_buffer_pct: 0.1
  rejection_wick_ratio: 0.5
  divergence_lookback: 14
  ema_bounce_proximity_pct: 0.30

# --- Scoring ---
scoring:
  weights:
    tradeability: 0.30
    direction: 0.25
    setup: 0.25
    sentiment: 0.20
  setup_components:
    pattern_quality: 30
    volume_confirmation: 20
    risk_reward: 25
    confluence: 25
  thresholds:
    strong: 80
    medium: 65
    weak: 50

# --- V4 specifique ---
# Direction neutre en swing = AUTORISE (comme V2)
swing_neutral_allowed: true

# --- V4 Features ---
v4_features:
  regime_detection: true       # Detection regime TRENDING/RANGING/VOLATILE
  mtf_confluence: true         # Multi-timeframe confluence scoring
  vwap_confluence: true        # VWAP comme S/R dynamique
  order_flow: true             # Analyse ratio bid/ask
  adaptive_learning: true      # Moteur d'apprentissage adaptatif
  stale_exit: true             # Fermeture positions stagnantes
  dynamic_sl: true             # Ajustement SL selon volatilite
  anti_correlation: true       # Garde max 3 positions meme direction

# --- Dashboard ---
dashboard:
  host: "0.0.0.0"
  port: 8000
