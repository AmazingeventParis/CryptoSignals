<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Signals MEXC</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/static/style.css?v=73">
</head>
<body>
    <div id="app">
        <div class="desktop-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0 0">
                <button onclick="resetAllPaper()" class="btn-reset-all" title="Reset tous les bots">Reset All</button>
                <button onclick="refreshAll()" class="btn-icon" title="Rafraichir">&#x21bb;</button>
            </div>

            <!-- Bot V1 (strict) -->
            <div class="bot-section">
                <header class="header bot-header">
                    <div class="header-left">
                        <h1><span class="v1-badge">V1</span> Bot V1</h1>
                        <span id="v1-status" class="badge badge-offline">offline</span>
                    </div>
                    <div class="header-right">
                        <span id="v1-balance" class="balance">--</span>
                        <button onclick="resetPaper('V1')" class="btn-icon" title="Reset V1" style="font-size:12px">RST</button>
                    </div>
                </header>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-value" id="v1-pnl">$0</div><div class="stat-label">P&L</div></div>
                    <div class="stat-card"><div class="stat-value" id="v1-winrate">0%</div><div class="stat-label">Win Rate</div></div>
                    <div class="stat-card"><div class="stat-value" id="v1-wins" style="color:var(--green)">0</div><div class="stat-label">Gagnes</div></div>
                    <div class="stat-card"><div class="stat-value" id="v1-losses" style="color:var(--red)">0</div><div class="stat-label">Perdus</div></div>
                    <div class="stat-card"><div class="stat-value" id="v1-active">0</div><div class="stat-label">Signaux</div></div>
                    <div class="stat-card"><div class="stat-value" id="v1-trades">0</div><div class="stat-label">Trades</div></div>
                </div>
                <div class="last-reset" id="v1-last-reset"></div>
            </div>

            <!-- Bot V2 (assoupli) -->
            <div class="bot-section">
                <header class="header bot-header">
                    <div class="header-left">
                        <h1><span class="v2-badge">V2</span> Bot V2</h1>
                        <span id="v2-status" class="badge badge-offline">offline</span>
                    </div>
                    <div class="header-right">
                        <span id="v2-balance" class="balance">--</span>
                        <button onclick="resetPaper('V2')" class="btn-icon" title="Reset V2" style="font-size:12px">RST</button>
                    </div>
                </header>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-value" id="v2-pnl">$0</div><div class="stat-label">P&L</div></div>
                    <div class="stat-card"><div class="stat-value" id="v2-winrate">0%</div><div class="stat-label">Win Rate</div></div>
                    <div class="stat-card"><div class="stat-value" id="v2-wins" style="color:var(--green)">0</div><div class="stat-label">Gagnes</div></div>
                    <div class="stat-card"><div class="stat-value" id="v2-losses" style="color:var(--red)">0</div><div class="stat-label">Perdus</div></div>
                    <div class="stat-card"><div class="stat-value" id="v2-active">0</div><div class="stat-label">Signaux</div></div>
                    <div class="stat-card"><div class="stat-value" id="v2-trades">0</div><div class="stat-label">Trades</div></div>
                </div>
                <div class="last-reset" id="v2-last-reset"></div>
            </div>

            <!-- Bot V3 (quick profit) -->
            <div class="bot-section">
                <header class="header bot-header">
                    <div class="header-left">
                        <h1><span class="v3-badge">V3</span> Bot V3</h1>
                        <span id="v3-status" class="badge badge-offline">offline</span>
                    </div>
                    <div class="header-right">
                        <span id="v3-balance" class="balance">--</span>
                        <button onclick="resetPaper('V3')" class="btn-icon" title="Reset V3" style="font-size:12px">RST</button>
                    </div>
                </header>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-value" id="v3-pnl">$0</div><div class="stat-label">P&L</div></div>
                    <div class="stat-card"><div class="stat-value" id="v3-winrate">0%</div><div class="stat-label">Win Rate</div></div>
                    <div class="stat-card"><div class="stat-value" id="v3-wins" style="color:var(--green)">0</div><div class="stat-label">Gagnes</div></div>
                    <div class="stat-card"><div class="stat-value" id="v3-losses" style="color:var(--red)">0</div><div class="stat-label">Perdus</div></div>
                    <div class="stat-card"><div class="stat-value" id="v3-active">0</div><div class="stat-label">Signaux</div></div>
                    <div class="stat-card"><div class="stat-value" id="v3-trades">0</div><div class="stat-label">Trades</div></div>
                </div>
                <div class="last-reset" id="v3-last-reset"></div>
            </div>

            <!-- Bot V4 (adaptive) -->
            <div class="bot-section">
                <header class="header bot-header">
                    <div class="header-left">
                        <h1><span class="v4-badge">V4</span> Bot V4</h1>
                        <span id="v4-status" class="badge badge-offline">offline</span>
                    </div>
                    <div class="header-right">
                        <span id="v4-balance" class="balance">--</span>
                        <button onclick="resetPaper('V4')" class="btn-icon" title="Reset V4" style="font-size:12px">RST</button>
                    </div>
                </header>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-value" id="v4-pnl">$0</div><div class="stat-label">P&L</div></div>
                    <div class="stat-card"><div class="stat-value" id="v4-winrate">0%</div><div class="stat-label">Win Rate</div></div>
                    <div class="stat-card"><div class="stat-value" id="v4-wins" style="color:var(--green)">0</div><div class="stat-label">Gagnes</div></div>
                    <div class="stat-card"><div class="stat-value" id="v4-losses" style="color:var(--red)">0</div><div class="stat-label">Perdus</div></div>
                    <div class="stat-card"><div class="stat-value" id="v4-active">0</div><div class="stat-label">Signaux</div></div>
                    <div class="stat-card"><div class="stat-value" id="v4-trades">0</div><div class="stat-label">Trades</div></div>
                </div>
                <div class="last-reset" id="v4-last-reset"></div>
            </div>

            <!-- Freqtrade Stats -->
            <div class="ft-stats-section">
                <header class="header ft-header">
                    <div class="header-left">
                        <h1><span class="ft-badge">FT</span> Freqtrade</h1>
                        <span id="ft-status" class="badge badge-offline">hors ligne</span>
                    </div>
                    <div class="header-right">
                        <span id="ft-balance" class="balance">--</span>
                    </div>
                </header>
                <div class="stats-row">
                    <div class="stat-card"><div class="stat-value" id="ft-pnl">$0</div><div class="stat-label">P&L</div></div>
                    <div class="stat-card"><div class="stat-value" id="ft-winrate">0%</div><div class="stat-label">Win Rate</div></div>
                    <div class="stat-card"><div class="stat-value" id="ft-wins" style="color:var(--green)">0</div><div class="stat-label">Gagnes</div></div>
                    <div class="stat-card"><div class="stat-value" id="ft-losses" style="color:var(--red)">0</div><div class="stat-label">Perdus</div></div>
                    <div class="stat-card"><div class="stat-value" id="ft-active">0</div><div class="stat-label">Signaux</div></div>
                    <div class="stat-card"><div class="stat-value" id="ft-trades">0</div><div class="stat-label">Trades</div></div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('v1')"><span class="v1-badge-sm">V1</span> Bot V1</button>
                <button class="tab" onclick="switchTab('v2')"><span class="v2-badge-sm">V2</span> Bot V2</button>
                <button class="tab" onclick="switchTab('v3')"><span class="v3-badge-sm">V3</span> Bot V3</button>
                <button class="tab" onclick="switchTab('v4')"><span class="v4-badge-sm">V4</span> Bot V4</button>
                <button class="tab" onclick="switchTab('freqtrade')"><span class="ft-badge-sm">FT</span> Freqtrade</button>
                <button class="tab" onclick="switchTab('charts')">Charts</button>
                <button class="tab" onclick="switchTab('trades')">Journal</button>
                <button class="tab" onclick="switchTab('compare')"><span class="compare-badge-sm">VS</span> Comparaison</button>
                <button class="tab" onclick="switchTab('historique')">Historique</button>
                <button class="tab" onclick="switchTab('pairs')">Paires</button>
            </div>

            <!-- V1 Tab -->
            <div id="tab-v1" class="tab-content active">
                <div id="v1-positions-live" class="positions-live"></div>
                <div id="v1-signals-list" class="signals-list">
                    <div class="empty-state">Chargement des signaux V1...</div>
                </div>
            </div>

            <!-- V2 Tab -->
            <div id="tab-v2" class="tab-content">
                <div id="v2-positions-live" class="positions-live"></div>
                <div id="v2-signals-list" class="signals-list">
                    <div class="empty-state">Chargement des signaux V2...</div>
                </div>
            </div>

            <!-- V3 Tab -->
            <div id="tab-v3" class="tab-content">
                <div id="v3-positions-live" class="positions-live"></div>
                <div id="v3-signals-list" class="signals-list">
                    <div class="empty-state">Chargement des signaux V3...</div>
                </div>
            </div>

            <!-- V4 Tab -->
            <div id="tab-v4" class="tab-content">
                <div id="v4-positions-live" class="positions-live"></div>
                <!-- V4 Learning Panel -->
                <div id="v4-learning-panel" class="learning-panel">
                    <h3 style="margin:0 0 12px 0;font-size:14px">Apprentissage Adaptatif</h3>
                    <div class="learning-grid">
                        <div class="learning-section">
                            <h4>Calibration Score</h4>
                            <div id="v4-calibration" class="calibration-grid"></div>
                        </div>
                        <div class="learning-section">
                            <h4>Edge Decay Alerts</h4>
                            <div id="v4-edge-decay" class="edge-decay-list"></div>
                        </div>
                        <div class="learning-section">
                            <h4>Top Poids Appris</h4>
                            <div id="v4-weights-top" class="weights-grid"></div>
                        </div>
                    </div>
                    <div class="learning-section" style="margin-top:12px">
                        <h4>Metriques Avancees</h4>
                        <div id="v4-advanced-stats" class="advanced-stats-grid"></div>
                    </div>
                </div>
                <div id="v4-signals-list" class="signals-list">
                    <div class="empty-state">Chargement des signaux V4...</div>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="tab-charts" class="tab-content">
                <div class="chart-controls">
                    <div class="pair-selector" id="pair-selector"></div>
                    <div class="tf-selector">
                        <button class="tf-btn" onclick="changeTimeframe('1m')">1m</button>
                        <button class="tf-btn" onclick="changeTimeframe('3m')">3m</button>
                        <button class="tf-btn active" onclick="changeTimeframe('5m')">5m</button>
                        <button class="tf-btn" onclick="changeTimeframe('15m')">15m</button>
                        <button class="tf-btn" onclick="changeTimeframe('1h')">1h</button>
                        <button class="tf-btn" onclick="changeTimeframe('4h')">4h</button>
                        <button class="tf-btn" onclick="changeTimeframe('1d')">1j</button>
                        <button class="tf-btn" onclick="changeTimeframe('1w')">1s</button>
                        <button id="vol-toggle" class="tf-btn active" onclick="toggleVolume()" style="margin-left:8px;border-color:var(--blue)">VOL ON</button>
                        <button id="fvg-toggle" class="tf-btn active" onclick="toggleFVG()" style="border-color:var(--green)">FVG ON</button>
                        <span id="candle-countdown" class="candle-countdown"></span>
                    </div>
                </div>
                <div class="ticker-bar" id="ticker-bar"></div>
                <div id="chart-container" class="chart-container"></div>
                <div id="volume-container" class="volume-container"></div>
            </div>

            <!-- Trades/Journal Tab -->
            <div id="tab-trades" class="tab-content">
                <div id="trades-list" class="trades-list">
                    <div class="empty-state">Aucun trade enregistre</div>
                </div>
            </div>

            <!-- Freqtrade Tab -->
            <div id="tab-freqtrade" class="tab-content">
                <div id="ft-open-trades" class="ft-section">
                    <div class="ft-section-title"><span class="dot dot-green"></span> Positions ouvertes</div>
                    <div id="ft-open-list"></div>
                </div>
                <div id="ft-closed-trades" class="ft-section">
                    <div class="ft-section-title">Historique des trades</div>
                    <div id="ft-closed-list"></div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div id="tab-compare" class="tab-content">
                <div class="compare-header">
                    <h2>V1 vs V2 vs V3 vs V4 vs FT â€” Performance</h2>
                    <div class="compare-period-selector">
                        <button class="period-btn active" onclick="changeCompPeriod(0)">Tout</button>
                        <button class="period-btn" onclick="changeCompPeriod(7)">7j</button>
                        <button class="period-btn" onclick="changeCompPeriod(30)">30j</button>
                    </div>
                </div>
                <div class="compare-stats">
                    <div class="compare-col compare-v1">
                        <div class="compare-col-header"><span class="v1-badge">V1</span> Bot V1 (strict)</div>
                        <div class="compare-stat"><span class="label">Balance</span><span id="comp-v1-balance" class="value">$100</span></div>
                        <div class="compare-stat"><span class="label">P&L</span><span id="comp-v1-pnl" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Trades</span><span id="comp-v1-trades" class="value">0</span></div>
                        <div class="compare-stat"><span class="label">Win Rate</span><span id="comp-v1-winrate" class="value">0%</span></div>
                        <div class="compare-stat"><span class="label">Gagnes / Perdus</span><span id="comp-v1-wl" class="value">0 / 0</span></div>
                    </div>
                    <div class="compare-col compare-v2">
                        <div class="compare-col-header"><span class="v2-badge">V2</span> Bot V2 (assoupli)</div>
                        <div class="compare-stat"><span class="label">Balance</span><span id="comp-v2-balance" class="value">$100</span></div>
                        <div class="compare-stat"><span class="label">P&L</span><span id="comp-v2-pnl" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Trades</span><span id="comp-v2-trades" class="value">0</span></div>
                        <div class="compare-stat"><span class="label">Win Rate</span><span id="comp-v2-winrate" class="value">0%</span></div>
                        <div class="compare-stat"><span class="label">Gagnes / Perdus</span><span id="comp-v2-wl" class="value">0 / 0</span></div>
                    </div>
                    <div class="compare-col compare-v3">
                        <div class="compare-col-header"><span class="v3-badge">V3</span> Bot V3 (quick profit)</div>
                        <div class="compare-stat"><span class="label">Balance</span><span id="comp-v3-balance" class="value">$100</span></div>
                        <div class="compare-stat"><span class="label">P&L</span><span id="comp-v3-pnl" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Trades</span><span id="comp-v3-trades" class="value">0</span></div>
                        <div class="compare-stat"><span class="label">Win Rate</span><span id="comp-v3-winrate" class="value">0%</span></div>
                        <div class="compare-stat"><span class="label">Gagnes / Perdus</span><span id="comp-v3-wl" class="value">0 / 0</span></div>
                    </div>
                    <div class="compare-col compare-v4">
                        <div class="compare-col-header"><span class="v4-badge">V4</span> Bot V4 (adaptive)</div>
                        <div class="compare-stat"><span class="label">Balance</span><span id="comp-v4-balance" class="value">$100</span></div>
                        <div class="compare-stat"><span class="label">P&L brut</span><span id="comp-v4-pnl" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Frais</span><span id="comp-v4-fees" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Trades</span><span id="comp-v4-trades" class="value">0</span></div>
                        <div class="compare-stat"><span class="label">Win Rate</span><span id="comp-v4-winrate" class="value">0%</span></div>
                        <div class="compare-stat"><span class="label">Gagnes / Perdus</span><span id="comp-v4-wl" class="value">0 / 0</span></div>
                        <div class="compare-stat"><span class="label">Profit Factor</span><span id="comp-v4-pf" class="value">--</span></div>
                        <div class="compare-stat"><span class="label">Sharpe</span><span id="comp-v4-sharpe" class="value">--</span></div>
                        <div class="compare-stat"><span class="label">Max DD</span><span id="comp-v4-maxdd" class="value">--</span></div>
                        <div class="compare-stat"><span class="label">Streak W/L</span><span id="comp-v4-streak" class="value">-- / --</span></div>
                    </div>
                    <div class="compare-col compare-ft">
                        <div class="compare-col-header"><span class="ft-badge">FT</span> Freqtrade</div>
                        <div class="compare-stat"><span class="label">Balance</span><span id="comp-ft-balance" class="value">--</span></div>
                        <div class="compare-stat"><span class="label">P&L</span><span id="comp-ft-pnl" class="value">$0</span></div>
                        <div class="compare-stat"><span class="label">Trades</span><span id="comp-ft-trades" class="value">0</span></div>
                        <div class="compare-stat"><span class="label">Win Rate</span><span id="comp-ft-winrate" class="value">0%</span></div>
                        <div class="compare-stat"><span class="label">Gagnes / Perdus</span><span id="comp-ft-wl" class="value">0 / 0</span></div>
                    </div>
                </div>
                <div id="compare-chart-container" class="compare-chart-container"></div>
            </div>

            <!-- Historique Tab -->
            <div id="tab-historique" class="tab-content">
                <div class="historique-header">
                    <h2>Historique Performance</h2>
                    <div class="historique-filters">
                        <button class="histo-btn active" onclick="changeHistoPeriod(24)">24h</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(48)">2j</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(72)">3j</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(96)">4j</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(120)">5j</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(144)">6j</button>
                        <button class="histo-btn" onclick="changeHistoPeriod(168)">1 sem</button>
                    </div>
                </div>
                <div id="historique-content" class="historique-content">
                    <div class="empty-state">Chargement...</div>
                </div>
            </div>

            <!-- Pairs Tab -->
            <div id="tab-pairs" class="tab-content">
                <div id="pairs-list" class="pairs-list">
                    <div class="empty-state">Chargement...</div>
                </div>
            </div>
        </main>
        </div>

        <!-- Modal execution -->
        <div id="exec-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeModal()">
            <div class="modal">
                <div class="modal-header">
                    <span id="modal-title">Confirmer l'ordre</span>
                    <button class="btn-icon" onclick="closeModal()">&times;</button>
                </div>
                <div id="modal-body" class="modal-body"></div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="closeModal()">Annuler</button>
                    <button id="modal-confirm" class="btn-exec" onclick="confirmExec()">Confirmer</button>
                </div>
            </div>
        </div>

        <!-- Modal Chart Popup -->
        <div id="chart-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeChartModal()">
            <div class="modal chart-modal-lg">
                <div class="modal-header">
                    <span id="chart-modal-title">Chart</span>
                    <button class="btn-icon" onclick="closeChartModal()">&times;</button>
                </div>
                <div class="chart-modal-controls">
                    <div class="tf-selector">
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1m')">1m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('3m')">3m</button>
                        <button class="popup-tf-btn active" onclick="popupChangeTimeframe('5m')">5m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('15m')">15m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1h')">1h</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('4h')">4h</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1d')">1j</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1w')">1s</button>
                        <button id="popup-vol-toggle" class="popup-tf-btn" onclick="popupToggleVolume()" style="margin-left:8px;border-color:var(--blue)">VOL</button>
                        <button id="popup-fvg-toggle" class="popup-tf-btn" onclick="popupToggleFVG()" style="border-color:var(--green)">FVG</button>
                        <span id="popup-candle-countdown" class="candle-countdown"></span>
                        <button class="popup-tf-btn" onclick="popupResetZoom()" style="margin-left:8px;border-color:var(--orange);color:var(--orange)">&#x1f50d; Reset</button>
                        <span style="font-size:10px;color:var(--text-secondary);margin-left:6px">Double-clic = zoom</span>
                    </div>
                </div>
                <div class="popup-chart-wrapper">
                    <div id="popup-chart-container" class="popup-chart-container"></div>
                    <div id="popup-levels-panel" class="popup-levels-panel"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&#x26a0; Ceci n'est PAS un conseil financier. Trading a vos risques et perils.</p>
        </footer>
    </div>

    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
            regs.forEach(r => r.unregister());
        });
        caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
    }
    </script>
    <script src="/static/app.js?v=73"></script>
</body>
</html>
