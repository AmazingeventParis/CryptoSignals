<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Signals MEXC</title>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/static/style.css?v=46">
</head>
<body>
    <div id="app">
        <div class="desktop-layout">
        <!-- SIDEBAR (gauche sur desktop) -->
        <aside class="sidebar">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1>Crypto Signals</h1>
                    <span id="status-badge" class="badge badge-offline">offline</span>
                </div>
                <div class="header-right">
                    <span id="balance-display" class="balance">--</span>
                    <button onclick="resetPaper()" class="btn-icon" title="Reset portfolio" style="font-size:12px">RST</button>
                    <button onclick="refreshAll()" class="btn-icon" title="Rafraichir">&#x21bb;</button>
                </div>
            </header>

            <!-- Stats cards (ordre: P&L, WinRate, Gagnes, Perdus, Signaux, Trades) -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="stat-pnl">$0</div>
                    <div class="stat-label">P&L Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-winrate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-wins" style="color:var(--green)">0</div>
                    <div class="stat-label">Gagnes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-losses" style="color:var(--red)">0</div>
                    <div class="stat-label">Perdus</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-active">0</div>
                    <div class="stat-label">Signaux actifs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-trades">0</div>
                    <div class="stat-label">Trades</div>
                </div>
            </div>

            <!-- Freqtrade Stats -->
            <div class="ft-stats-section">
                <div class="ft-stats-header">
                    <span class="ft-badge">FT</span> Freqtrade
                    <span id="ft-balance" class="balance">--</span>
                    <span id="ft-status" class="ft-status offline">offline</span>
                </div>
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="ft-pnl">$0</div>
                        <div class="stat-label">P&L</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ft-wins" style="color:var(--green)">0</div>
                        <div class="stat-label">Gagnes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ft-losses" style="color:var(--red)">0</div>
                        <div class="stat-label">Perdus</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ft-winrate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ft-trades">0</div>
                        <div class="stat-label">Trades</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT (droite sur desktop) -->
        <main class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('signals')">Crypto Signals</button>
                <button class="tab" onclick="switchTab('freqtrade')"><span class="ft-badge-sm">FT</span> Freqtrade</button>
                <button class="tab" onclick="switchTab('charts')">Charts</button>
                <button class="tab" onclick="switchTab('trades')">Journal</button>
                <button class="tab" onclick="switchTab('pairs')">Paires</button>
            </div>

            <!-- Positions actives (live) - au-dessus des tabs content -->
            <div id="positions-live" class="positions-live"></div>

            <!-- Signals Tab -->
            <div id="tab-signals" class="tab-content active">
                <div id="signals-list" class="signals-list">
                    <div class="empty-state">Chargement des signaux...</div>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="tab-charts" class="tab-content">
                <!-- Pair selector -->
                <div class="chart-controls">
                    <div class="pair-selector" id="pair-selector"></div>
                    <div class="tf-selector">
                        <button class="tf-btn" onclick="changeTimeframe('1m')">1m</button>
                        <button class="tf-btn" onclick="changeTimeframe('3m')">3m</button>
                        <button class="tf-btn active" onclick="changeTimeframe('5m')">5m</button>
                        <button class="tf-btn" onclick="changeTimeframe('15m')">15m</button>
                        <button class="tf-btn" onclick="changeTimeframe('1h')">1h</button>
                        <button class="tf-btn" onclick="changeTimeframe('4h')">4h</button>
                        <button class="tf-btn" onclick="changeTimeframe('1d')">1j</button>
                        <button class="tf-btn" onclick="changeTimeframe('1w')">1s</button>
                        <button id="vol-toggle" class="tf-btn active" onclick="toggleVolume()" style="margin-left:8px;border-color:var(--blue)">VOL ON</button>
                        <button id="fvg-toggle" class="tf-btn active" onclick="toggleFVG()" style="border-color:var(--green)">FVG ON</button>
                    </div>
                </div>
                <!-- Price ticker bar -->
                <div class="ticker-bar" id="ticker-bar"></div>
                <!-- Chart container -->
                <div id="chart-container" class="chart-container"></div>
                <!-- Volume chart -->
                <div id="volume-container" class="volume-container"></div>
            </div>

            <!-- Trades Tab -->
            <div id="tab-trades" class="tab-content">
                <div id="trades-list" class="trades-list">
                    <div class="empty-state">Aucun trade enregistre</div>
                </div>
            </div>

            <!-- Freqtrade Tab -->
            <div id="tab-freqtrade" class="tab-content">
                <div id="ft-open-trades" class="ft-section">
                    <div class="ft-section-title"><span class="dot dot-green"></span> Positions ouvertes</div>
                    <div id="ft-open-list"></div>
                </div>
                <div id="ft-closed-trades" class="ft-section">
                    <div class="ft-section-title">Historique des trades</div>
                    <div id="ft-closed-list"></div>
                </div>
            </div>

            <!-- Pairs Tab -->
            <div id="tab-pairs" class="tab-content">
                <div id="pairs-list" class="pairs-list">
                    <div class="empty-state">Chargement...</div>
                </div>
            </div>
        </main>
        </div>

        <!-- Modal execution -->
        <div id="exec-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeModal()">
            <div class="modal">
                <div class="modal-header">
                    <span id="modal-title">Confirmer l'ordre</span>
                    <button class="btn-icon" onclick="closeModal()">&times;</button>
                </div>
                <div id="modal-body" class="modal-body"></div>
                <div class="modal-actions">
                    <button class="btn-cancel" onclick="closeModal()">Annuler</button>
                    <button id="modal-confirm" class="btn-exec" onclick="confirmExec()">Confirmer</button>
                </div>
            </div>
        </div>

        <!-- Modal Chart Popup (pour positions) -->
        <div id="chart-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeChartModal()">
            <div class="modal chart-modal-lg">
                <div class="modal-header">
                    <span id="chart-modal-title">Chart</span>
                    <button class="btn-icon" onclick="closeChartModal()">&times;</button>
                </div>
                <div class="chart-modal-controls">
                    <div class="tf-selector">
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1m')">1m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('3m')">3m</button>
                        <button class="popup-tf-btn active" onclick="popupChangeTimeframe('5m')">5m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('15m')">15m</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1h')">1h</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('4h')">4h</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1d')">1j</button>
                        <button class="popup-tf-btn" onclick="popupChangeTimeframe('1w')">1s</button>
                        <button id="popup-vol-toggle" class="popup-tf-btn" onclick="popupToggleVolume()" style="margin-left:8px;border-color:var(--blue)">VOL</button>
                        <button id="popup-fvg-toggle" class="popup-tf-btn" onclick="popupToggleFVG()" style="border-color:var(--green)">FVG</button>
                        <button class="popup-tf-btn" onclick="popupResetZoom()" style="margin-left:8px;border-color:var(--orange);color:var(--orange)">&#x1f50d; Reset</button>
                        <span style="font-size:10px;color:var(--text-secondary);margin-left:6px">Double-clic = zoom</span>
                    </div>
                </div>
                <div id="popup-chart-container" class="popup-chart-container"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>&#x26a0; Ceci n'est PAS un conseil financier. Trading a vos risques et perils.</p>
        </footer>
    </div>

    <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
    <script>
    // Purger ancien Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
            regs.forEach(r => r.unregister());
        });
        caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
    }
    </script>
    <script src="/static/app.js?v=46"></script>
</body>
</html>
